{% extends "partials/_layout.html" %}

{% block title %}Create Group{% endblock %}

{% block page_title %}Create Group{% endblock %}

{% block header_icon %}
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-plus-icon lucide-user-plus"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" x2="19" y1="8" y2="14"/><line x1="22" x2="16" y1="11" y2="11"/></svg>
{% endblock %}

{% block header_buttons %}
<a href="/home/">
<button class="btn btn-outline-secondary p-2" id="homebutton">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-house-icon lucide-house"><path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"/><path d="M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg>
</button>
</a>
{% endblock %}

{% block calendar_content %}
<div class="h-100 d-flex flex-column justify-content-center px-5" style="gap: 20px; overflow-y: auto;">
    <h5>Group name:</h5>
    <div class="d-flex flex-row align-items-center justify-content-center" style="gap: 10px;">
        <input type="text" id="groupName" name="groupName" class="form-control" placeholder="Group Name"><br>
    </div>

    <h5>Enter group-members' usernames:</h5>
    <div class="d-flex flex-row align-items-center justify-content-center" style="gap: 10px;">
        <input type="text" id="email" name="email" class="form-control" placeholder="Username"><br>
        <button type="button" id="addButton" class="addButton">Add</button>
    </div>

    <h5>Invited Members:</h5>
    <div id="emailList" class="h-100 border rounded d-flex flex-column p-4 justify-content-center px-5" style="gap: 20px; overflow-y: auto;">
        <!-- Empty State-->
    </div>
    <a href="/home/">
        <button type="submit" class="btn custom-creategroup mt-auto w-100 d-flex align-items-center justify-content-center" style="gap: 10px;" id="createGroup">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus-icon lucide-plus"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
            Create Group
        </button>
    </a>
</div>
{% endblock %}

{% block scripts %}
<script>
    const emailInput = document.getElementById('email');
    const emailList = document.getElementById('emailList');
    const addButton = document.getElementById('addButton');
    const createGroup = document.getElementById('createGroup');

    const savedEmails = [];

    function handleAdd() {
        const email = emailInput.value.trim();
        if (email) {
            savedEmails.push(email);

            const emailTag = document.createElement('div');
            emailTag.className = 'd-flex justify-content-between border rounded px-2 py-1 bg-light';
    
            const emailText = document.createElement('span');
            emailText.textContent = email;
    
            const removeBtn = document.createElement('button');
            removeBtn.textContent = 'Ã—'; 
            removeBtn.className = 'btn btn-sm btn-light';
            removeBtn.style.padding = '0 5px';
            removeBtn.style.border = 'none';
            removeBtn.style.background = 'transparent';
            removeBtn.style.cursor = 'pointer';
    
            removeBtn.addEventListener('click', () => {
                emailList.removeChild(emailTag);
                const index = savedEmails.indexOf(email);
                
                if (index > -1) {
                  savedEmails.splice(index, 1);
                }
            });
    
            emailTag.appendChild(emailText);
            emailTag.appendChild(removeBtn);
            emailList.appendChild(emailTag);
    
            emailInput.value = '';
        }
    }
    
    emailInput.addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
            event.preventDefault();
            handleAdd();
        }
    });
    
    addButton.addEventListener('click', handleAdd);

    const groupName = document.getElementById("groupName");
    async function CreateGroup() {
      if (savedEmails.length <= 0) {
        return;
      }
      
      const csrftoken = getCookie('csrftoken');

      const response = await fetch("{% url 'creategroup' %}", {
        method: "POST",
        credentials: "include",
        headers: {
          "X-CSRFToken": csrftoken,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          emails: savedEmails,
          groupName: groupName.value
        })
      });

      console.log(response.body);
    }

    createGroup.addEventListener("click", () => {
      CreateGroup();
    })
</script>
{% endblock %}
